---
// Products.astro

import { urlFor } from '@/lib/sanity' 
import { getProducts } from '@/data/products' 
const products = await getProducts()

interface SanityImage {
  asset: {
    _ref: string
  }
}

interface Product {
  name: string
  url: string
  image: SanityImage
  hoverImage?: SanityImage
  bgColor?: string
  bgSize?: 'cover' | 'contain'
  darkBackground?: boolean
}
  

if (!products?.length) return null

---

<section id="shop" class="products shop">
  <div class="shop__hero">
    <!-- <img src="/shop/bg.png" alt="The Lava Shop - Est. 2024" /> -->
  </div> 
  <div class="wrapper">
    <div class="shop__logo">
      <img src="/shop/the-lava-shop.png" alt="The Lava Shop - Est. 2024" />
    </div>
      
    <div class="container products__grid"> 
      {products.map((product) => (
        <a
          href={product.url}
          target="_blank"
          rel="noopener noreferrer"
          class={`product__card product__card--${product._id} ${product.darkBackground ? 'product__card--dark' : ''}`}
          style={`
            background-image: url(${urlFor(product.image).width(800).auto('format').url()});
            background-color: ${product.bgColor ?? 'transparent'};
            background-size: ${product.bgSize ?? 'contain'};
            background-position: center;
            background-repeat: no-repeat;
          `}
        >
          <img
            src={urlFor(product.hoverImage).width(800).auto('format').url()}
            alt={product.name}
            loading="lazy"
            class="product__image product__hover-image"
          /> 
          <div class="product__content">
            <span class="product__name">{product.name}</span>
            <span class="product__view-text">View Details <span>â†’</span></span>
          </div>
        </a>
      ))}
    </div>
  </div>
</section>

<script>
  import { initCustomCursor } from '../../scripts/utils/custom-cursor.js';

  // Initialize custom cursor for product cards
  if (typeof window !== 'undefined') {
    if (document.readyState === 'complete') {
      initCustomCursor('.product__card', {
        text: 'View',
        cursorId: 'shop-cursor',
      });
    } else {
      window.addEventListener('load', () => {
        initCustomCursor('.product__card', {
          text: 'View',
          cursorId: 'shop-cursor',
        });
      });
    }
  }
</script>
